<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coder 4.2</title>
<style>
:root {
--b: #1e1e1e;
--t: #d4d4d4;
--c: #3794ff;
--p: #2d2d2d;
--f: 'Courier New', monospace;
}
body {
margin: 0;
overflow: hidden;
background: var(--b);
transition: background 0.3s ease, color 0.3s ease;
}
#e {
width: 100vw;
height: 100vh;
box-sizing: border-box;
background: transparent;
color: var(--t);
border: 0;
outline: 0;
resize: none;
font: 16px/26px var(--f);
white-space: pre;
caret-color: var(--c);
transition: caret-color 0.3s;
padding: 20px 20px 50vh 20px;
tab-size: 2;
caret-shape: block;
}
#t {
position: fixed;
bottom: 30px;
right: 30px;
background: var(--p);
color: var(--c);
border-left: 4px solid var(--c);
padding: 12px 20px;
font: 13px var(--f);
font-weight: bold;
pointer-events: none;
opacity: 0;
transform: translateY(20px);
transition: opacity 0.3s ease, transform 0.3s ease, color 0.3s, border-color 0.3s;
z-index: 99;
box-shadow: 0 4px 15px rgba(0,0,0,0.3);
border-radius: 4px;
}
#t.show {
opacity: 1;
transform: translateY(0);
}
#h {
display: none;
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: var(--p);
color: var(--c);
border: 1px solid var(--c);
padding: 25px;
font: 14px var(--f);
z-index: 100;
box-shadow: 0 10px 40px rgba(0,0,0,0.6);
white-space: pre;
line-height: 1.6;
border-radius: 8px;
}
</style>
</head>
<body>
<textarea id="e" spellcheck="false"></textarea>
<div id="t"></div>
<div id="h">
<span id="close-h" onclick="E.toggleHelp()" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:20px; font-weight:bold;">&times;</span>
Coder 4.2 (C) 2022-25 Johnny Heggelund
-------------------------------------------
Web Code Editor for HTML, CSS & JS
-------------------------------------------
SHORTCUTS (Alt + Key)
-------------------------------------------
[Alt + N] New File
[Alt + O] Open File
[Alt + S] Save File
[Alt + T] Cycle Theme
[Alt + P] Preview HTML
[Alt + C] Next Comment (Selects)
[Alt + F] Next Function (Cursor at start)
[Alt + W] Next Trailing Space (Selects)
[Alt + E] Next Empty Line (Cursor at start)
[Alt + H] Toggle This Help
</div>
<script>
const E = {
h: null,
n: 'Untitled',
d: false,
e: null,
tm: null,
ti: 0,
themes: [
{ n: 'Modern Dark',  b: '#1e1e1e', t: '#d4d4d4', c: '#3794ff', p: '#252526' },
{ n: 'Clean Light',  b: '#ffffff', t: '#24292f', c: '#0969da', p: '#f6f8fa' },
{ n: 'Monokai Vivid',b: '#272822', t: '#f8f8f2', c: '#a6e22e', p: '#1e1f1c' },
{ n: 'Soft Retro',   b: '#282828', t: '#ebdbb2', c: '#fe8019', p: '#32302f' },
{ n: 'Night Owl',    b: '#011627', t: '#d6deeb', c: '#82aaff', p: '#0b2942' },
{ n: 'Hacker',       b: '#000000', t: '#00ff00', c: '#00ff00', p: '#111111' }
],
init() {
this.e = document.getElementById('e');
this.e.oninput = () => { if (!this.d) this.dirty(true) };
this.e.onkeydown = this.tab.bind(this);
document.onkeydown = this.key.bind(this);
window.onbeforeunload = e => { if (this.d) { e.preventDefault(); e.returnValue = '' } };

document.addEventListener('click', (e) => {
    if (e.target === document.body) {
      this.e.focus();
    }
  });

this.applyTheme(0);
this.e.focus();
this.toggleHelp();
},
dirty(s) {
this.d = s;
document.title = `${s ? '*' : ''}${this.n}`;
},
new() {
if (this.d && !confirm("Unsaved changes. Discard?")) return;
this.e.value = '';
this.h = null;
this.n = 'Untitled';
this.dirty(false);
this.toast('New File Created');
this.e.focus();
this.e.scrollTo(0, 0);
},
cycleTheme() {
this.ti = (this.ti + 1) % this.themes.length;
this.applyTheme(this.ti);
},
applyTheme(i) {
this.ti = i;
const th = this.themes[i];
const r = document.documentElement.style;
r.setProperty('--b', th.b);
r.setProperty('--t', th.t);
r.setProperty('--c', th.c);
r.setProperty('--p', th.p);
this.toast(`Theme: ${th.n}`);
},
async file(save) {
if (!window.showOpenFilePicker) return alert("Browser does not support File System API");
try {
if (save) {
if (!this.h) this.h = await showSaveFilePicker({
suggestedName: this.n,
types: [{ description: 'Code', accept: { 'text/plain': ['.txt', '.html', '.js', '.css', '.md', '.json'] } }]
});
const w = await this.h.createWritable();
await w.write(this.e.value);
await w.close();
this.n = this.h.name;
this.dirty(false);
this.toast(`Saved: ${this.n}`);
} else {
if (this.d && !confirm("Unsaved changes. Discard?")) return;
[this.h] = await showOpenFilePicker();
const f = await this.h.getFile();
this.e.value = await f.text();
this.n = f.name;
this.dirty(false);
this.toast(`Opened: ${this.n}`);
}
} catch (e) {
if (e.name !== 'AbortError') this.toast(e.message);
}
},
jump(regex, type, select = true) {
this.e.focus();
const val = this.e.value, cur = this.e.selectionEnd;
let m, first = null, next = null;
regex.lastIndex = 0;
while ((m = regex.exec(val)) !== null) {
if (m.index === regex.lastIndex) regex.lastIndex++;
const item = { idx: m.index, len: m[0].length };
if (!first) first = item;
if (m.index > cur) {
next = item;
break;
}
}
const t = next || first;
if (t) {
if (select) this.e.setSelectionRange(t.idx, t.idx + t.len);
else this.e.setSelectionRange(t.idx, t.idx);
this.scroll(t.idx, 'auto');
this.toast(`Found ${type} ${next ? '↓' : '↻'}`);
} else {
this.toast(`No ${type} found`);
}
},
scroll(idx, behavior) {
const el = this.e;
const lh = 26;
const l = el.value.substr(0, idx).split('\n').length - 1;
el.scrollTo({
top: (l * lh) - (el.clientHeight / 2) + (lh / 2),
behavior: behavior
});
},
toggleHelp() {
  const h = document.getElementById('h');
  const isOpening = h.style.display !== 'block';
  
  h.style.display = isOpening ? 'block' : 'none';
  
  // If we just closed the help modal, refocus the editor
  if (!isOpening) {
    this.e.focus();
  }
},
toast(m) {
const el = document.getElementById('t');
el.innerText = m;
el.classList.add('show');
if (this.tm) clearTimeout(this.tm);
this.tm = setTimeout(() => {
el.classList.remove('show');
}, 3000);
},
key(e) {
if (e.altKey && !e.ctrlKey && !e.shiftKey) {
const k = e.key.toLowerCase();
const map = {
'n': () => this.new(),
'o': () => this.file(0),
's': () => this.file(1),
't': () => this.cycleTheme(),
'p': () => {
const w = window.open();
if (w) { w.document.write(this.e.value); w.document.close(); }
},
'c': () => this.jump(/(\/\*[\s\S]*?\*\/|(?<!:)\/\/.*)/g, 'Comment', true),
'f': () => this.jump(/(^\s*(?!if|for|while|switch|catch)\w+\s*\(.*?\)\s*\{|^\s*function\s+\w+)/gm, 'Function', false),
'w': () => this.jump(/[ \t]+$/gm, 'Trailing Space', true),
'e': () => this.jump(/^\s*$/gm, 'Empty Line', false),
'h': () => this.toggleHelp()
};
if (map[k]) {
e.preventDefault();
const h = document.getElementById('h');
if (h.style.display === 'block' && k !== 'h') this.toggleHelp();
map[k]();
}
}
if (e.key === 'Escape') {
const h = document.getElementById('h');
if (h.style.display === 'block') {
e.preventDefault();
this.toggleHelp();
}
}
},
tab(e) {
if (e.key !== 'Tab') return;
e.preventDefault();
const el = this.e, val = el.value, s = el.selectionStart, end = el.selectionEnd;
const startLine = val.lastIndexOf('\n', s - 1) + 1, endLine = val.indexOf('\n', end - 1);
const final = endLine === -1 ? val.length : endLine;
const lines = val.substring(startLine, final).split('\n');
let ch = false;
const newVal = lines.map(r => {
if (e.shiftKey) return (r.startsWith('  ') || r.startsWith(' ')) ? (ch = true, r.replace(/^ {1,2}/, '')) : r;
return ch = true, '  ' + r
}).join('\n');
if (ch) {
el.setRangeText(newVal, startLine, final, 'select');
if (!this.d) this.dirty(true);
}
}
};
window.onload = () => E.init();
</script>
</body>
</html>